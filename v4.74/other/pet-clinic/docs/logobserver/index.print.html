<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.12.2+tip"><meta name=description content="Splunk Observability Workshops"><title>4. Log Observer :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.74/other/pet-clinic/docs/logobserver/index.html rel=canonical type=text/html title="4. Log Observer :: Splunk Observability Cloud Workshops"><link href=../../../../other/pet-clinic/docs/logobserver/index.xml rel=alternate type=application/rss+xml title="4. Log Observer :: Splunk Observability Cloud Workshops"><link href=../../../../images/favicon.ico?1680256168 rel=icon type=image/x-icon><link href=../../../../css/fontawesome-all.min.css?1680256169 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fontawesome-all.min.css?1680256169 rel=stylesheet></noscript><link href=../../../../css/nucleus.css?1680256169 rel=stylesheet><link href=../../../../css/auto-complete.css?1680256169 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/auto-complete.css?1680256169 rel=stylesheet></noscript><link href=../../../../css/perfect-scrollbar.min.css?1680256169 rel=stylesheet><link href=../../../../css/fonts.css?1680256169 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../../css/fonts.css?1680256169 rel=stylesheet></noscript><link href=../../../../css/theme.css?1680256169 rel=stylesheet><link href=../../../../css/theme-splunk-light.css?1680256169 rel=stylesheet id=variant-style><link href=../../../../css/variant.css?1680256169 rel=stylesheet><link href=../../../../css/print.css?1680256169 rel=stylesheet media=print><link href=../../../../css/format-print.css?1680256169 rel=stylesheet><link href=../../../../css/ie.css?1680256169 rel=stylesheet><script src=../../../../js/url.js?1680256169></script>
<script src=../../../../js/variant.js?1680256169></script>
<script>window.index_js_url="../../../../index.search.js";var root_url="../../../../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \u0022{0}\u0022",window.T_N_results_found="{1} results found for \u0022{0}\u0022",baseUriFull="https://splunk.github.io/observability-workshop/v4.74/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script><style>@media screen and (min-width:1300px){#body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1300px;width:100%}}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../../other/pet-clinic/docs/logobserver/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../other/index.html><span itemprop=name>Other Workshops</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../../other/pet-clinic/index.html><span itemprop=name>PetClinic Java Workshop</span></a><meta itemprop=position content="3">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>4. Log Observer</span><meta itemprop=position content="4"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><div id=head-tags></div><article class=default><h1 id=4-log-observer>4. Log Observer</h1><h2 id=1-introduction>1. Introduction</h2><p>For the Splunk Log Observer component, we will configure the Spring PetClinic application to write logs to a file in the filesystem and configure the Splunk OpenTelemetry Collect to read (tail) that log file and report the information to the Splunk Observability Platform.</p><h2 id=2-fluentd-configuration>2. FluentD Configuration</h2><p>We need to configure the Splunk OpenTelemetry Collector to tail the Spring PetClinic log file and report the data to the Splunk Observability Cloud endpoint.</p><p>The Splunk OpenTelemetry Collector uses FluentD to consume/report logs and to configure the proper setting to report Spring PetClinic logs, we just need to add a FluentD configuration file in the default directory (<code>/etc/otel/collector/fluentd/conf.d/</code>).</p><p>Here&rsquo;s the sample FluentD configuration file (<code>petclinic.conf</code>, reading the file <code>/tmp/spring-petclinic.log</code>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>&lt;source&gt;
</span></span><span class=line><span class=cl>  @type tail
</span></span><span class=line><span class=cl>  @label @SPLUNK
</span></span><span class=line><span class=cl>  tag petclinic.app
</span></span><span class=line><span class=cl>  path /tmp/spring-petclinic.log
</span></span><span class=line><span class=cl>  pos_file /tmp/spring-petclinic.pos_file
</span></span><span class=line><span class=cl>  read_from_head false
</span></span><span class=line><span class=cl>  &lt;parse&gt;
</span></span><span class=line><span class=cl>    @type none
</span></span><span class=line><span class=cl>  &lt;/parse&gt;
</span></span><span class=line><span class=cl>&lt;/source&gt;
</span></span></code></pre></div><p>So we need to create the file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vi /etc/otel/collector/fluentd/conf.d/petclinic.conf
</span></span></code></pre></div><p>We also need to change permission and ownership of the petclinic.conf file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo chown td-agent:td-agent /etc/otel/collector/fluentd/conf.d/petclinic.conf
</span></span><span class=line><span class=cl>sudo chmod <span class=m>755</span> /etc/otel/collector/fluentd/conf.d/petclinic.conf
</span></span></code></pre></div><p>And paste the contents from the snippet above. Once the file is created, we need to restart the FluentD process</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart td-agent
</span></span></code></pre></div><h2 id=3-logback-settings>3. Logback Settings</h2><p>The Spring PetClinic application can be configure to use a number of different java logging libraries. In this scenario, we are using logback. Here&rsquo;s a sample logback configuration file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE xml&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;configuration</span> <span class=na>scan=</span><span class=s>&#34;true&#34;</span> <span class=na>scanPeriod=</span><span class=s>&#34;30 seconds&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;contextListener</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.classic.jul.LevelChangePropagator&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;resetJUL&gt;</span>true<span class=nt>&lt;/resetJUL&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/contextListener&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&#34;org.springframework.samples.petclinic&#34;</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;appender</span> <span class=na>name=</span><span class=s>&#34;file&#34;</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.RollingFileAppender&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;file&gt;</span>/tmp/spring-petclinic.log<span class=nt>&lt;/file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rollingPolicy</span> <span class=na>class=</span><span class=s>&#34;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;fileNamePattern&gt;</span>springLogFile.%d{yyyy-MM-dd}.log<span class=nt>&lt;/fileNamePattern&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;maxHistory&gt;</span>5<span class=nt>&lt;/maxHistory&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;totalSizeCap&gt;</span>1GB<span class=nt>&lt;/totalSizeCap&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rollingPolicy&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;encoder&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;pattern&gt;</span>
</span></span><span class=line><span class=cl>      %d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg trace_id=%X{trace_id} span_id=%X{span_id} trace_flags=%X{trace_flags} service.name=%property{otel.resource.service.name}, deployment.environment=%property{otel.resource.deployment.environment} %n
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/encoder&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/appender&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;root</span> <span class=na>level=</span><span class=s>&#34;debug&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&#34;file&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/root&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>We just need to create a file named logback.xml in the configuration folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vi src/main/resources/logback.xml
</span></span></code></pre></div><p>and paste the XML content from the snippet above. After that, we need to rebuild the application and run it again:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./mvnw package -Dmaven.test.skip<span class=o>=</span><span class=nb>true</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dotel.service.name<span class=o>=</span><span class=k>$(</span>hostname<span class=k>)</span>-petclinic.service <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.profiler.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-Dsplunk.metrics.enabled<span class=o>=</span><span class=nb>true</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>-jar target/spring-petclinic-*.jar --spring.profiles.active<span class=o>=</span>mysql
</span></span></code></pre></div><p>Then let&rsquo;s visit the application again to generate more traffic, now we should see log messages being reported <code>http://&lt;VM_IP_ADDRESS>:8080</code> (feel free to navigate and click around).</p><p>Then visit:
Hamburger Menu > Log Observer</p><p>And you can add a filter to select only log messages from your host and the Spring PetClinic Application:</p><ol><li>Add Filter → Fields → <code>host.name</code> → <code>&lt;your host name></code></li><li>Add Filter → Fields → <code>service.name</code> → <code>&lt;your host name>-petclinic.service</code></li></ol><h2 id=4-summary>4. Summary</h2><p>This the end of the exercise and we have certainly covered a lot of ground. At this point you should have metrics, traces, logs, database query performance and code profiling being reported into Splunk Observability Cloud. <strong>Congratulations</strong>!</p><footer class=footline></footer></article></div></main></div><script src=../../../../js/clipboard.min.js?1680256170 defer></script>
<script src=../../../../js/perfect-scrollbar.min.js?1680256170 defer></script>
<script src=../../../../js/theme.js?1680256170 defer></script></body></html>