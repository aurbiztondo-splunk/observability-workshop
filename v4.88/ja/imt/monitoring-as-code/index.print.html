<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.110.0"><meta name=generator content="Relearn 5.14.3+tip"><meta name=description content="Splunk Observability ワークショップ"><title>Monitoring as Code :: Splunk Observability Cloud Workshops</title><link href=https://splunk.github.io/observability-workshop/v4.88/en/imt/monitoring-as-code/index.html rel=alternate hreflang=x-default><link href=https://splunk.github.io/observability-workshop/v4.88/en/imt/monitoring-as-code/index.html rel=alternate hreflang=en><link href=https://splunk.github.io/observability-workshop/v4.88/ja/imt/monitoring-as-code/index.html rel=alternate hreflang=ja><link href=https://splunk.github.io/observability-workshop/v4.88/ja/imt/monitoring-as-code/index.html rel=canonical type=text/html title="Monitoring as Code :: Splunk Observability Cloud Workshops"><link href=../../../ja/imt/monitoring-as-code/index.xml rel=alternate type=application/rss+xml title="Monitoring as Code :: Splunk Observability Cloud Workshops"><link href=../../../images/favicon.ico?1684957790 rel=icon type=image/x-icon><link href=../../../css/fontawesome-all.min.css?1684957791 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fontawesome-all.min.css?1684957791 rel=stylesheet></noscript><link href=../../../css/nucleus.css?1684957791 rel=stylesheet><link href=../../../css/auto-complete.css?1684957791 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/auto-complete.css?1684957791 rel=stylesheet></noscript><link href=../../../css/perfect-scrollbar.min.css?1684957791 rel=stylesheet><link href=../../../css/fonts.css?1684957791 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../../css/fonts.css?1684957791 rel=stylesheet></noscript><link href=../../../css/theme.css?1684957791 rel=stylesheet><link href=../../../css/theme-splunk-light.css?1684957791 rel=stylesheet id=variant-style><link href=../../../css/variant.css?1684957791 rel=stylesheet><link href=../../../css/print.css?1684957791 rel=stylesheet media=print><link href=../../../css/format-print.css?1684957791 rel=stylesheet><link href=../../../css/ie.css?1684957791 rel=stylesheet><script src=../../../js/url.js?1684957791></script>
<script src=../../../js/variant.js?1684957791></script>
<script>window.index_js_url="../../../ja/index.search.js";var root_url="../../../",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="クリップボードにコピー",window.T_Copied_to_clipboard="クリップボードにコピー!",window.T_Copy_link_to_clipboard="リンクをクリップボードにコピー",window.T_Link_copied_to_clipboard="リンクをクリップボードにコピーしました!",window.T_No_results_found="\u0022{0}\u0022 の結果が見つかりません",window.T_N_results_found="\u0022{0}\u0022 で {1} 件の結果が見つかりました",baseUriFull="https://splunk.github.io/observability-workshop/v4.88/",window.variants&&variants.init(["splunk-light","splunk-dark","aws"])</script><style>@media screen and (min-width:1300px){#body .flex-block-wrapper{margin-left:auto;margin-right:auto;max-width:1300px;width:100%}}</style></head><body class="mobile-support print disableInlineCopyToClipboard" data-url=../../../ja/imt/monitoring-as-code/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='メニュー (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../ja/index.html><span itemprop=name>Splunk Observability Workshops</span></a><meta itemprop=position content="1">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../../ja/imt/index.html><span itemprop=name>Splunk IM</span></a><meta itemprop=position content="2">></li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Monitoring as Code</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=monitoring-as-code>Monitoring as Code</h1><span class="btn cstyle transparent"><button type=button>
<i class="fa-fw fas fa-clock"></i>
10分</button></span><ul><li>Terraform<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> を使用して Observability Cloud のダッシュボードとディテクターを管理します。</li><li>Terraform のSplunk Provider<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> を初期化します</li><li>Terraformを実行して、Splunk Terraform Provider を使用してコードからディテクターとダッシュボードを作成します。</li><li>Terraformでディテクターやダッシュボードを削除する方法を確認します。</li></ul><hr><h2 id=1-初期設定>1. 初期設定</h2><p>Monitoring as Codeは、infrastructure as Codeと同じアプローチを採用しています。アプリケーション、サーバー、その他のインフラコンポーネントと同じようにモニタリングを管理できます。</p><p>Monitoring as Codeでは、可視化したり、何を監視するか定義したり、いつアラートを出すかなどを管理します。つまり、監視設定、プロセス、ルールをバージョン管理、共有、再利用することができます。</p><p>Splunk Terraform Providerの完全なドキュメントは<a href=https://registry.terraform.io/providers/splunk-terraform/signalfx/latest/docs target=_blank>こちら</a>にあります。</p><p>AWS/EC2 インスタンスにログインして、<code>o11y-cloud-jumpstart</code> ディレクトリに移動します</p><div class=tab-panel data-tab-group=7bf809055e04d8465533af8584bba8e9><div class=tab-nav><button data-tab-item="Change directory" class="tab-nav-button active" onclick='switchTab("7bf809055e04d8465533af8584bba8e9","Change directory")'>
<span>Change directory</span></button></div><div class=tab-content><div data-tab-item="Change directory" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> observability-content-contrib/integration-examples/terraform-jumpstart
</span></span></code></pre></div></div></div></div><p>必要な環境変数は、<a href=../../../ja/imt/monitoring-as-code/../gdi/#2-helm%e3%81%ab%e3%82%88%e3%82%8b%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab>Helmによるインストール</a> ですでに設定されているはずです。そうでない場合は、以下の Terraform のステップで使用するために、以下の環境変数を作成してください。</p><div class=tab-panel data-tab-group=758be9c8a756f1cdc813ad56db9fcb77><div class=tab-nav><button data-tab-item="Export ACCESS TOKEN" class="tab-nav-button active" onclick='switchTab("758be9c8a756f1cdc813ad56db9fcb77","Export ACCESS TOKEN")'>
<span>Export ACCESS TOKEN</span></button></div><div class=tab-content><div data-tab-item="Export ACCESS TOKEN" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ACCESS_TOKEN</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_O11y-Workshop-ACCESS_TOKEN&gt;&#34;</span>
</span></span></code></pre></div></div></div></div><div class=tab-panel data-tab-group=2385bdd0589ff019b76ff7b375e4e444><div class=tab-nav><button data-tab-item="Export REALM" class="tab-nav-button active" onclick='switchTab("2385bdd0589ff019b76ff7b375e4e444","Export REALM")'>
<span>Export REALM</span></button></div><div class=tab-content><div data-tab-item="Export REALM" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>REALM</span><span class=o>=</span><span class=s2>&#34;&lt;replace_with_REALM&gt;&#34;</span>
</span></span></code></pre></div></div></div></div><p>Terraform を初期化し、Splunk Terraform Provider を最新版にアップグレードします。</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Note: SignalFx Terraform Provider のアップグレード</div><div class=box-content><p>Splunk Terraform Provider の新バージョンがリリースされるたびに、以下のコマンドを実行する必要があります。リリース情報は <a href=https://github.com/splunk-terraform/terraform-provider-signalfx/releases target=_blank>GitHub</a> で確認できます。</p></div></div><div class=tab-panel data-tab-group=999d64b89f0d1d05d10b054f842062d0><div class=tab-nav><button data-tab-item="Initialise Terraform" class="tab-nav-button active" onclick='switchTab("999d64b89f0d1d05d10b054f842062d0","Initialise Terraform")'>
<span>Initialise Terraform</span></button>
<button data-tab-item="Initialise Output" class=tab-nav-button onclick='switchTab("999d64b89f0d1d05d10b054f842062d0","Initialise Output")'>
<span>Initialise Output</span></button></div><div class=tab-content><div data-tab-item="Initialise Terraform" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform init -upgrade
</span></span></code></pre></div></div><div data-tab-item="Initialise Output" class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>    Upgrading modules...
</span></span><span class=line><span class=cl>    - aws in modules/aws
</span></span><span class=line><span class=cl>    - azure in modules/azure
</span></span><span class=line><span class=cl>    - docker in modules/docker
</span></span><span class=line><span class=cl>    - gcp in modules/gcp
</span></span><span class=line><span class=cl>    - host in modules/host
</span></span><span class=line><span class=cl>    - kafka in modules/kafka
</span></span><span class=line><span class=cl>    - kubernetes in modules/kubernetes
</span></span><span class=line><span class=cl>    - parent_child_dashboard in modules/dashboards/parent
</span></span><span class=line><span class=cl>    - pivotal in modules/pivotal
</span></span><span class=line><span class=cl>    - rum_and_synthetics_dashboard in modules/dashboards/rum_and_synthetics
</span></span><span class=line><span class=cl>    - usage_dashboard in modules/dashboards/usage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Initializing the backend...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Initializing provider plugins...
</span></span><span class=line><span class=cl>    - Finding latest version of splunk-terraform/signalfx...
</span></span><span class=line><span class=cl>    - Installing splunk-terraform/signalfx v6.20.0...
</span></span><span class=line><span class=cl>    - Installed splunk-terraform/signalfx v6.20.0 (self-signed, key ID CE97B6074989F138)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Partner and community providers are signed by their developers.
</span></span><span class=line><span class=cl>    If you&#39;d like to know more about provider signing, you can read about it here:
</span></span><span class=line><span class=cl>    https://www.terraform.io/docs/cli/plugins/signing.html
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Terraform has created a lock file .terraform.lock.hcl to record the provider
</span></span><span class=line><span class=cl>    selections it made above. Include this file in your version control repository
</span></span><span class=line><span class=cl>    so that Terraform can guarantee to make the same selections by default when
</span></span><span class=line><span class=cl>    you run &#34;terraform init&#34; in the future.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Terraform has been successfully initialized!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    You may now begin working with Terraform. Try running &#34;terraform plan&#34; to see
</span></span><span class=line><span class=cl>    any changes that are required for your infrastructure. All Terraform commands
</span></span><span class=line><span class=cl>    should now work.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    If you ever set or change modules or backend configuration for Terraform,
</span></span><span class=line><span class=cl>    rerun this command to reinitialize your working directory. If you forget, other
</span></span><span class=line><span class=cl>    commands will detect it and remind you to do so if necessary.
</span></span></code></pre></div></div></div></div><h2 id=2-プランの作成>2. プランの作成</h2><p><code>terraform plan</code> コマンドで、実行計画を作成します。デフォルトでは、プランの作成は以下のように構成されています。</p><ul><li>既に存在するリモートオブジェクトの現在の状態を読み込み、Terraform の状態が最新であることを確認します</li><li>現在の設定を以前の状態と比較し、相違点を抽出します</li><li>適用された場合にリモートオブジェクトと設定とを一致させるための、一連の変更アクションを提案します</li></ul><p>plan コマンドだけでは、提案された変更を実際に実行はされなません。変更を適用する前に、以下のコマンドを実行して、提案された変更が期待したものと一致するかどうかを確認しましょう。</p><div class=tab-panel data-tab-group=9ff81156705147779bf8c847ae90a282><div class=tab-nav><button data-tab-item="Execution Plan" class="tab-nav-button active" onclick='switchTab("9ff81156705147779bf8c847ae90a282","Execution Plan")'>
<span>Execution Plan</span></button>
<button data-tab-item="Execution Plan Output" class=tab-nav-button onclick='switchTab("9ff81156705147779bf8c847ae90a282","Execution Plan Output")'>
<span>Execution Plan Output</span></button></div><div class=tab-content><div data-tab-item="Execution Plan" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform plan -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;o11y_prefix=[</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>]&#34;</span>
</span></span></code></pre></div></div><div data-tab-item="Execution Plan Output" class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Plan: 146 to add, 0 to change, 0 to destroy.
</span></span></code></pre></div></div></div></div><p>プランが正常に実行されれば、そのまま apply することができます。</p><hr><h2 id=3-プランの適用>3. プランの適用</h2><p><code>terraform apply</code> コマンドは、上記の Terraform プランで提案されたアクションを実行します。</p><p>この場合、新しい実行プランが自動的に作成され（<code>terraform plan</code>を実行したときと同様です）、指示されたアクションを実行する前にAccess Token、Realm（プレフィックスのデフォルトは<code>Splunk</code>）の提供とプランの承認を求められます。</p><p>このワークショップでは、プレフィックスがユニークである必要があります。以下の <code>terraform apply</code> を実行してください。</p><div class=tab-panel data-tab-group=05b24064e3f88336391f6b21765c322f><div class=tab-nav><button data-tab-item="Apply Plan" class="tab-nav-button active" onclick='switchTab("05b24064e3f88336391f6b21765c322f","Apply Plan")'>
<span>Apply Plan</span></button>
<button data-tab-item="Apply Plan Output" class=tab-nav-button onclick='switchTab("05b24064e3f88336391f6b21765c322f","Apply Plan Output")'>
<span>Apply Plan Output</span></button></div><div class=tab-content><div data-tab-item="Apply Plan" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform apply -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;o11y_prefix=[</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>]&#34;</span>
</span></span></code></pre></div></div><div data-tab-item="Apply Plan Output" class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Apply complete! Resources: 146 added, 0 changed, 0 destroyed.
</span></span></code></pre></div></div></div></div><p>適用が完了したら、 <strong>Alerts → Detectors</strong> でディテクターが作成されたことを確認してください。ディテクターのプレフィックスには、インスタンスのホスト名が入ります。プレフィックスの値を確認するには以下を実行してください。</p><div class=tab-panel data-tab-group=2ec10007119202848e8fcba27648926c><div class=tab-nav><button data-tab-item="Echo Hostname" class="tab-nav-button active" onclick='switchTab("2ec10007119202848e8fcba27648926c","Echo Hostname")'>
<span>Echo Hostname</span></button></div><div class=tab-content><div data-tab-item="Echo Hostname" class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=k>$(</span>hostname<span class=k>)</span>
</span></span></code></pre></div></div></div></div><p>新しいディテクターのリストが表示され、上から出力されたプレフィックスを検索することができます。</p><p><a href=#image-449a401343fcb527766e4f99e057778a class=lightbox-link><img src=../../../ja/imt/monitoring-as-code/../images/detectors.png alt=Detectors style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-449a401343fcb527766e4f99e057778a><img src=../../../ja/imt/monitoring-as-code/../images/detectors.png alt=Detectors class=lightbox-image loading=lazy></a></p><h2 id=4-苦労して作ったもの全てを壊す>4. 苦労して作ったもの全てを壊す</h2><p><code>terraform destroy</code> コマンドは、Terraform の設定で管理されているすべてのリモートオブジェクトを破壊する便利な方法です。</p><p>通常、本番環境では長期保存可能なオブジェクトを破棄することはありませんが、Terraformでは開発目的で一時的なインフラを管理するために使用されることがあり、その場合は作業が終わった後に <code>terraform destroy</code> を実行して、一時的なオブジェクトをすべてクリーンアップすることができます。</p><p>それでは、ここまでで適用したダッシュボードとディテクターを全て破壊しましょう！</p><div class=tab-panel data-tab-group=594bfe81ce3f5b812492693105332fc1><div class=tab-nav><button data-tab-item=Destroy class="tab-nav-button active" onclick='switchTab("594bfe81ce3f5b812492693105332fc1","Destroy")'>
<span>Destroy</span></button>
<button data-tab-item="Destroy Output" class=tab-nav-button onclick='switchTab("594bfe81ce3f5b812492693105332fc1","Destroy Output")'>
<span>Destroy Output</span></button></div><div class=tab-content><div data-tab-item=Destroy class="tab-content-text active"><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>terraform destroy -var<span class=o>=</span><span class=s2>&#34;access_token=</span><span class=nv>$ACCESS_TOKEN</span><span class=s2>&#34;</span> -var<span class=o>=</span><span class=s2>&#34;realm=</span><span class=nv>$REALM</span><span class=s2>&#34;</span>
</span></span></code></pre></div></div><div data-tab-item="Destroy Output" class=tab-content-text><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Destroy complete! Resources: 146 destroyed.
</span></span></code></pre></div></div></div></div><p><em><strong>Alerts → Detectors</strong></em> に移動して、すべてのディテクターが削除されたことを確認してください。</p><p><a href=#image-7c6372fa5b1f8d6538ab1765ee56f414 class=lightbox-link><img src=../../../ja/imt/monitoring-as-code/../images/destroy.png alt=Destroyed style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox id=image-7c6372fa5b1f8d6538ab1765ee56f414><img src=../../../ja/imt/monitoring-as-code/../images/destroy.png alt=Destroyed class=lightbox-image loading=lazy></a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Terraform は、インフラを安全かつ効率的に構築、変更、バージョン管理するためのツールです。Terraform は、既存の一般的なサービスプロバイダーだけでなく、様々なカスタムソリューションも管理できます。</p><p>Terraform の設定ファイルには、単一のアプリケーションまたはデータセンター全体を実行するために必要なコンポーネントをに記述します。Terraform はそれを受けて、望ましい状態に到達するために何をするかを記述した実行プランを生成し、記述されたインフラを構築するために実行します。設定が変更されても、Terraform は何が変更されたかを判断し、差分の実行プランを作成して適用することができます。</p><p>Terraform が管理できるインフラには、計算機インスタンス、ストレージ、ネットワークなどのローレベルのコンポーネントや、DNSエントリ、SaaS機能などのハイレベルのコンポーネントが含まれます。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>プロバイダーは、APIのインタラクションを理解し、リソースを公開する責務があります。一般的にプロバイダーは、IaaS（Alibaba Cloud、AWS、GCP、Microsoft Azure、OpenStackなど）、PaaS（Herokuなど）、またはSaaSサービス（Splunk、Terraform Cloud、DNSimple、Cloudflareなど）があります。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><footer class=footline></footer></article></div></main></div><script src=../../../js/clipboard.min.js?1684957791 defer></script>
<script src=../../../js/perfect-scrollbar.min.js?1684957791 defer></script>
<script src=../../../js/theme.js?1684957791 defer></script></body></html>